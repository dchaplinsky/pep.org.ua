{% extends "base.jinja" %}
{% from "macros/_pagination.jinja" import render_pagination with context %}

{% block content %}
<div class="container">
    <div class="row">

        <div id="breadcrumbs">
            <ol class="breadcrumb">
                <li><a href="#">Головна</a></li>
                <li><a href="#">Результати пошуку</a></li>
                <li class="active">Публічні діячі</li>
            </ol> 
        </div>

        <section id="search-results">
            {% if persons %}
                <h2 class="text-center">Фізичні особи</h2>
                {% for p in persons %}
                <div class="small-profile {% if p.is_pep %}fizik{% else %}linked{% endif %} col-sm-6" itemscope itemtype="http://schema.org/Person">
                    <link itemprop="url" href="{{ url("person_details", person_id=p.id) }}" />
                    <div class="box" onclick="location.href='{{ url("person_details", person_id=p.id) }}';">
                        <header class="profile-header">
                            <div class="avatar">
                            {% if p.photo %}
                                <img src="{{ p.photo|thumbnail_url("small_avatar") }}" itemprop="image" />
                            {% endif %}
                            </div>

                            <h3 class="pep-name" itemprop="name">
                                <span itemprop="familyName">{{ p.last_name }}</span> <span class="pep-pib"><span itemprop="givenName">{{ p.first_name }}</span> <span itemprop="additionalName">{{ p.patronymic }}</span>
                            </h3>
                        </header>

                        <div class="descr">
                            {% if p.date_of_birth %}
                            <meta itemprop="birthDate" content="{{ p.dob }} "/>
                            <p><span>Дата рождения:</span> {{ p.date_of_birth }}</p>
                            {% endif %}
                            {% if p.last_workplace %}
                            <p>
                                <span>Последнее место работы:</span>
                                <span itemprop="worksFor" itemscope itemtype="http://schema.org/Organization">{{ p.last_workplace }}</span>, 
                                <span itemprop="jobTitle">{{ p.last_job_title }}</span>
                            </p>
                            {% endif %}
                            {% if p.risk_category %}
                            <p><a href="#" data-toggle="tooltip" data-placement="top" title="Какой-то пояснительный текст что-это означает и чтобы всем вообще было понятно :)"><span>Рівень ризику:</span> <span class="riskLevel">{{ p.risk_category }}</a></p>
                            {% endif %}
                        </div>
                    </div>
                
                </div>
                {% if loop.index is divisibleby 2 %}
                    <div class="clearfix"></div>
                {% endif %}
                {% endfor %}
                
                {% if persons.paginator.num_pages > 1 %}
                <div class="text-center">
                    <nav>
                    {{ render_pagination(persons, url("search_person")) }}
                    </nav>
                </div>
                {% endif %}
            {% endif %}


            {% if related_persons %}
            <h2 class="text-center">Пов'язані особи</h2>

                {% for p in related_persons %}
                <div class="small-profile {% if p.is_pep %}fizik{% else %}linked{% endif %} col-sm-6"> 
                        <div class="box" onclick="location.href='{{ url("person_details", person_id=p.id) }}';">
                            <header class="profile-header">
                                <div class="avatar">
                                </div>
                                <h3 class="pep-name">
                                    {{ p.last_name }}<span class="pep-pib">{{ p.first_name }} {{ p.patronymic }}</span>
                                </h3>
                            </header>
    
                            <div class="descr">
                                {% if p.date_of_birth %}
                                <p><span>Дата рождения:</span> {{ p.date_of_birth }}</p>
                                {% endif %}
                                {% if p.last_workplace %}
                                <p><span>Последнее место работы:</span> {{ p.last_workplace }}</p>
                                {% endif %}
                                {% if p.risk_category %}
                                <p><a href="#"  data-toggle="tooltip" data-placement="top" title="Какой-то пояснительный текст что-это означает и чтобы всем вообще было понятно :)"><span>Рівень ризику:</span> <span class="riskLevel">{{ p.risk_category }}</a></p>
                                {% endif %}
                                <p>
                                    {% for rel in p.relevant_related_persons()[:4] %}
                                        <span>Связь:</span> {% if rel.relationship_type %}{{ rel.relationship_type }}, {% endif %}{{ rel.person }}<br />
                                    {% endfor %}
                                </p>
                            </div>
                        </div>
                </div>
                {% if loop.index is divisibleby 2 %}
                    <div class="clearfix"></div>
                {% endif %}
                {% endfor %}
                
                {% if related_persons.paginator.num_pages > 1 %}
                <div class="text-center">
                    <nav>
                    {{ render_pagination(related_persons, url("search_related")) }}
                    </nav>
                </div>
                {% endif %}
            {% endif %}

        </section>
    </div>
</div>
{% endblock %}